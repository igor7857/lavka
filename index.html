<!DOCTYPE HTML>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="height=device-height, initial-scale=1.0">
    <meta content="text/css">
    <title>Калькулятор лавки</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png"/>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>Калькулятор лавки</h2>
    <p>амбер-уши/горы<br>руби-уши<br>есть тайники ивента по 295 чм</p>
    <div id="form_1" class="forma">
    <p id="скр">цена товара в чм</p>
    <input type="number" id="i_цена_товара_в_чм_1" min="1" value="73" oninput="tt()">
        <br id="br" style="display: none">
    <p id="ыть">единиц товара</p>
    <input type="number" id="i_единиц_товара_1" min="1" value="1" oninput="tt()">
        <div class="bt_i">
            <button onclick="op('i_единиц_товара_1', -5, 0)">-5</button>
            <button onclick="op('i_единиц_товара_1', -1, 0)">-1</button>
            <button onclick="op('i_единиц_товара_1', +1, 0)">+1</button>
            <button onclick="op('i_единиц_товара_1', +5, 0)">+5</button>
        </div>
    </div>

    <div>
        <button id="шаг1" onclick="шаг1()" style="display: block">+</button>
    </div>

    <div id="form_2" class="forma" style="display: none">
    <input placeholder="цена товара в чм" type="number" id="i_цена_товара_в_чм_2" min="1" oninput="tt()">
        <br>
    <input placeholder="единиц товара" type="number" id="i_единиц_товара_2" min="1" oninput="tt()">
        <div class="bt_i">
            <button onclick="op('i_единиц_товара_2', -5, 0)">-5</button>
            <button onclick="op('i_единиц_товара_2', -1, 0)">-1</button>
            <button onclick="op('i_единиц_товара_2', +1, 0)">+1</button>
            <button onclick="op('i_единиц_товара_2', +5, 0)">+5</button>
        </div>
    </div>

    <div>
        <button id="шаг2" onclick="шаг2()" style="display: none">+</button>
    </div>

    <div id="form_3" class="forma" style="display: none">
    <input placeholder="цена товара в чм" type="number" id="i_цена_товара_в_чм_3" min="1" oninput="tt()">
        <br>
    <input placeholder="единиц товара" type="number" id="i_единиц_товара_3" min="1" oninput="tt()">
        <div class="bt_i">
            <button onclick="op('i_единиц_товара_3', -5, 0)">-5</button>
            <button onclick="op('i_единиц_товара_3', -1, 0)">-1</button>
            <button onclick="op('i_единиц_товара_3', +1, 0)">+1</button>
            <button onclick="op('i_единиц_товара_3', +5, 0)">+5</button>
        </div>
    </div>

    <div>
        <button id="шаг3" onclick="шаг3()" style="display: none;">+</button>
    </div>

    <div id="form_4" class="forma" style="display: none">
    <input placeholder="цена товара в чм" type="number" id="i_цена_товара_в_чм_4" min="1" oninput="tt()">
        <br>
    <input placeholder="единиц товара" type="number" id="i_единиц_товара_4" min="1" oninput="tt()">
        <div class="bt_i">
            <button onclick="op('i_единиц_товара_4', -5, 0)">-5</button>
            <button onclick="op('i_единиц_товара_4', -1, 0)">-1</button>
            <button onclick="op('i_единиц_товара_4', +1, 0)">+1</button>
            <button onclick="op('i_единиц_товара_4', +5, 0)">+5</button>
        </div>
    </div>

    <div class="forma" style="text-align: right;">
        <p id="vRub">руб</p>
        <p id="vRaG" style="display: none;">руб+голд</p>
        <p style="display: inline">право неожиданности<input class="ch" type="checkbox" id="i_bonus" oninput="tt()" style="margin-left: 5px; vertical-align: middle;"></p>
    </div>

    <div id="form_99">
        <div class="forma">
            <p>продать за</p>
            <input type="number" id="i_продать_за" min="0" oninput="tt()">
            <div class="bt_i">
                <p style="display: inline"><input class="ch" type="checkbox" id="i_chb" oninput="tt()" style="margin-top: 5px; margin-right: 5px;">через перекупа</p>
                <button onclick="op('i_продать_за', -500, 0)">-500</button>
                <button onclick="op('i_продать_за', +500, 0)">+500</button>
            </div>
            <p id="vGold" style="text-align: center">с продажи</p>
            <p id="vGoldSum" style="text-align: center">с продажи всего</p>
        </div>
        <div class="forma" style="text-align: center">
            <p id="vKurs1kg">цена за 1000 голд</p>
            <p id="vKurs1r">за 1 руб</p>
        </div>
    </div>

    <script>
        tt();
        function tt(){
            let курс = 0.12;

            let продать_за = document.getElementById("i_продать_за").value;
            if (продать_за.length == 0) {продать_за = 0};

            let ЕТ_1 = document.getElementById("i_единиц_товара_1").value;
            if (ЕТ_1.length == 0) {ЕТ_1 = 0};
            let ЦТ_1 = document.getElementById("i_цена_товара_в_чм_1").value;
            if (ЦТ_1.length == 0) {ЦТ_1 = 0};

            let ЕТ_2 = document.getElementById("i_единиц_товара_2").value;
            if (ЕТ_2.length == 0) {ЕТ_2 = 0};
            let ЦТ_2 = document.getElementById("i_цена_товара_в_чм_2").value;
            if (ЦТ_2.length == 0) {ЦТ_2 = 0};

            let ЕТ_3 = document.getElementById("i_единиц_товара_3").value;
            if (ЕТ_3.length == 0) {ЕТ_3 = 0};
            let ЦТ_3 = document.getElementById("i_цена_товара_в_чм_3").value;
            if (ЦТ_3.length == 0) {ЦТ_3 = 0};

            let ЕТ_4 = document.getElementById("i_единиц_товара_4").value;
            if (ЕТ_4.length == 0) {ЕТ_4 = 0};
            let ЦТ_4 = document.getElementById("i_цена_товара_в_чм_4").value;
            if (ЦТ_4.length == 0) {ЦТ_4 = 0};

            let всего_чм = (ЕТ_1*ЦТ_1)+(ЕТ_2*ЦТ_2)+(ЕТ_3*ЦТ_3)+(ЕТ_4*ЦТ_4);
            let rub = всего_чм * курс;
            rub = fix_rub(rub);
            document.getElementById("vRub").innerHTML = rub + " руб";

            let Rg = 3500 / 30750 * всего_чм;
            Rg = fix_Rg(Rg)
            let rG = (rub - Rg)
            rG = fix_rG(rG);
            document.getElementById("vRaG").innerHTML = Rg + ` руб + ` + rG + ` голд`;

            let с_продажи;
            let ch = document.getElementById("i_chb");
            if (ch.checked) {
                с_продажи = продать_за / 100 * 90;
                с_продажи = Math.ceil(с_продажи);
            }
            else{
                с_продажи = продать_за;
            }
            let с_продажи_всего = с_продажи * ЕТ_1;

            document.getElementById("vGold").innerHTML = "с продажи " + с_продажи + " голд";
            document.getElementById("vGoldSum").innerHTML = "с продажи всего " + с_продажи_всего + " голд";

            document.getElementById("vRaG").style.textDecoration = 'none';

            let razn = rub - Rg;
            razn = razn.toFixed(2);

            let bonus = document.getElementById("i_bonus");
            if (bonus.checked) {
                rub = rub - razn;
                rub = fix_rub(rub);
                курс = 3500 / 30750;
                document.getElementById("vRub").innerHTML = rub + " руб";
                document.getElementById("vRaG").style.textDecoration = 'line-through';
            }

            let Kurs1kg = ЦТ_1 * курс / с_продажи * 1000;
            Kurs1kg = Kurs1kg.toFixed(2);
            let Kurs1r = с_продажи / (ЦТ_1 * курс);
            Kurs1r = Math.round(Kurs1r);
            if (Kurs1kg == Infinity) {
            Kurs1kg = 0
            };
            document.getElementById("vKurs1kg").innerHTML = "цена за 1000 голд " + Kurs1kg + " руб";
            document.getElementById("vKurs1r").innerHTML = "за 1 руб " + Kurs1r + " голд";

            
        }

        function op (i, n, temp){
            temp = Number(document.getElementById(i).value);
            document.getElementById(i).value = n+temp;
            if (document.getElementById(i).value < 0) {document.getElementById(i).value = 0};
            tt()
        }

        function fix_rub(a){
            a = a.toFixed(2);
            if (a >= 50) {a = Math.floor(a);}
            if (a < 50) {
                a = a * 10;
                a = Math.ceil(a);
                a = a / 10;
                a = a.toFixed(2);
            }
            return a;
        }

        function fix_Rg(a){
            if (a < 50) {
                a = a * 10;
                a = Math.ceil(a);
                a = a / 10;
                a = a.toFixed(2);
            }
            if (a >= 50) {a = Math.ceil(a);}
            return a;
        }

        function fix_rG(a){
            a = a.toFixed(2);
            a = a * 5 * 100;
            return a;
        }

        function шаг1(){
            document.getElementById('скр').style.display = 'none';
            document.getElementById('ыть').style.display = 'none';
            document.getElementById('br').style.display = 'block';
            document.getElementById('form_99').style.display = 'none';
            document.getElementById('form_2').style.display = 'block';
            document.getElementById('шаг2').style.display = 'block';
            document.getElementById('шаг1').style.display = 'none';
        }
        function шаг2(){
            document.getElementById('form_3').style.display = 'block';
            document.getElementById('шаг3').style.display = 'block';
            document.getElementById('шаг2').style.display = 'none';
        }
        function шаг3(){
            document.getElementById('form_4').style.display = 'block';
            document.getElementById('шаг3').style.display = 'none';
        }
    </script>
</body>
</html>
